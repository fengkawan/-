<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">
<head>
  <meta charset="utf-8">
  <title>按年份变化的动态条形图</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #container {
      flex: 1;
      min-height: 500px;
    }
    .controls {
      padding: 10px;
      text-align: center;
      background-color: #f5f5f5;
    }
    button {
      margin: 0 5px;
      padding: 6px 12px;
      cursor: pointer;
    }
    #yearDisplay {
      font-size: 24px;
      font-weight: bold;
      margin: 0 20px;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <div class="controls">
    <button id="prevYear">上一年</button>
    <span id="yearDisplay">2015</span>
    <button id="nextYear">下一年</button>
    <button id="playPause">播放</button>
  </div>

  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom);
    var app = {};
    
    // 预设从2015年到2025年的数据
    const years = [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025];
    const categories = ['中国', '美国', '日本', '德国', '英国', '法国', '印度', '意大利', '巴西', '加拿大'];
    
    // 为每个类别生成从2015年到2025年的模拟数据（有增长趋势）
    const categoryData = {};
    categories.forEach(category => {
      const baseValue = Math.random() * 100 + 100; // 基础值在100-200之间
      const growthRate = Math.random() * 0.1 + 0.05; // 年增长率在5%-15%之间
      
      categoryData[category] = years.map((year, index) => {
        // 随年份增长，后期可能有波动
        const volatility = Math.random() * 0.2 - 0.1; // 波动范围在-10%到+10%之间
        return Math.round(baseValue * Math.pow(1 + growthRate, index) * (1 + volatility));
      });
    });
    
    // 当前年份索引
    let currentYearIndex = 0;
    let isPlaying = false;
    let playInterval;
    
    // 更新年份显示
    function updateYearDisplay() {
      document.getElementById('yearDisplay').textContent = years[currentYearIndex];
    }
    
    // 获取当前年份的数据
    function getCurrentData() {
      return categories.map(category => ({
        name: category,
        value: categoryData[category][currentYearIndex]
      }));
    }
    
    // 初始化图表
    const option = {
      backgroundColor: '#f8f9fa',
      title: {
        text: '各国经济指标对比（2015-2025）',
        left: 'center',
        textStyle: {
          fontSize: 20,
          color: '#333'
        }
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'shadow'
        },
        formatter: function(params) {
          const param = params[0];
          return `<div style="font-weight:bold">${param.name}</div>
                  <div>${years[currentYearIndex]}年: ${param.value}</div>`;
        }
      },
      xAxis: {
        type: 'value',
        name: '数值',
        max: 'dataMax',
        axisLabel: {
          formatter: function(value) {
            if (value >= 1000) {
              return (value / 1000) + 'k';
            }
            return value;
          }
        }
      },
      yAxis: {
        type: 'category',
        inverse: true,
        animationDuration: 300,
        animationDurationUpdate: 300,
        max: 9 // 显示全部10个类别
      },
      series: [
        {
          realtimeSort: true,
          name: '指标值',
          type: 'bar',
          data: getCurrentData(),
          label: {
            show: true,
            position: 'right',
            valueAnimation: true,
            formatter: function(params) {
              return params.value;
            }
          },
          itemStyle: {
            color: function(params) {
              // 根据排名设置不同颜色
              const rankColors = [
                '#FF6B6B', '#00CC96', '#4ECDC4', '#C779D0', '#F9C855',
                '#6A89CC', '#B8E994', '#FDA7DF', '#82CCDD', '#F8C291'
              ];
              return rankColors[params.dataIndex] || '#999';
            }
          }
        }
      ],
      animationDuration: 1000,
      animationDurationUpdate: 1000,
      animationEasing: 'elasticOut',
      animationEasingUpdate: 'elasticOut'
    };
    
    myChart.setOption(option);
    
    // 更新图表数据
    function updateChart() {
      myChart.setOption({
        yAxis: {
          data: categories
        },
        series: [
          {
            data: getCurrentData()
          }
        ]
      });
      updateYearDisplay();
    }
    
    // 下一年
    function nextYear() {
      if (currentYearIndex < years.length - 1) {
        currentYearIndex++;
        updateChart();
      }
    }
    
    // 上一年
    function prevYear() {
      if (currentYearIndex > 0) {
        currentYearIndex--;
        updateChart();
      }
    }
    
    // 播放/暂停
    function togglePlay() {
      if (isPlaying) {
        clearInterval(playInterval);
        document.getElementById('playPause').textContent = '播放';
      } else {
        playInterval = setInterval(nextYear, 1500);
        document.getElementById('playPause').textContent = '暂停';
      }
      isPlaying = !isPlaying;
    }
    
    // 绑定按钮事件
    document.getElementById('prevYear').addEventListener('click', prevYear);
    document.getElementById('nextYear').addEventListener('click', nextYear);
    document.getElementById('playPause').addEventListener('click', togglePlay);
    
    // 窗口大小变化时重绘图表
    window.addEventListener('resize', myChart.resize);
    
    // 初始化显示
    updateYearDisplay();
  </script>
</body>
</html>